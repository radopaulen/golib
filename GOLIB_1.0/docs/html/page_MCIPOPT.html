<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GOLIB: Local (Continuous) Optimization using IPOPT and FADBAD++</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GOLIB
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('page_MCIPOPT.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Local (Continuous) Optimization using IPOPT and FADBAD++ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="author"><dt><b>Author:</b></dt><dd>Benoit C. Chachuat </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>0.1 </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>2011 </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000006">Bug:</a></b></dt><dd>No known bugs.</dd></dl>
<p>Consider the mathematical program (NLP) <img class="formulaInl" alt="$\mathcal{P}:\min\{f({\bf x}):g_j({\bf x})\{\leq,=,\geq\} 0, j=1,\ldots,n_g; x_i^\ell\leq x_i\leq x_i^u, i=1,\ldots,n_x\}$" src="form_52.png"/>, where <img class="formulaInl" alt="$f, g_1, \ldots,g_{n_g}$" src="form_53.png"/> are factorable, potentially nonlinear, real-valued functions. The class <a class="el" href="classmc_1_1IPOPT.html" title="C++ derived class for NLP solution using IPOPT and FADBAD++.">mc::IPOPT</a> in MC++ solves such NLP problems using the software package <a href="https://projects.coin-or.org/Ipopt">IPOPT</a>, which implements a local solution method (interior point). IPOPT requires the first and second derivatives as well as the sparsity pattern of the objective and constraint functions in the NLP model. This information is generated automatically in <a class="el" href="classmc_1_1IPOPT.html" title="C++ derived class for NLP solution using IPOPT and FADBAD++.">mc::IPOPT</a> using <a href="http://www.fadbad.com/fadbad.html">FADBAD++</a> for the differentiations and <a class="el" href="classmc_1_1Structure.html" title="C++ class for evaluation of the sparsity pattern of a factorable function.">mc::Structure</a> in MC++ for the sparsity pattern.</p>
<p><a class="el" href="classmc_1_1IPOPT.html" title="C++ derived class for NLP solution using IPOPT and FADBAD++.">mc::IPOPT</a> is templated in the NLP problem to be solved, which has to be a class derived from <a class="el" href="classmc_1_1NLPSTRUCT.html" title="C++ base class for nonlinear optimization problem formulation.">mc::NLPSTRUCT</a>. For example, suppose we want to solve the following NLP: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align*} \max_{\bf p}\ &amp; p_1+p_2 \\ \text{s.t.} \ &amp; p_1\,p_2 \leq 4 \\ &amp; 3 \leq p_1 \leq 6\\ &amp; 0 \leq p_2 \leq 4. \end{align*}" src="form_54.png"/>
</p>
<p> The following class is defined: </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &quot;mcipopt.h&quot;</span>
  
  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NP = 2;
  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NC = 1;

  <span class="keyword">class </span>NLP : <span class="keyword">public</span> <span class="keyword">virtual</span> mc::NLPSTRUCT
  {
  <span class="keyword">public</span>:
    NLP(): mc::NLPSTRUCT( NP, NC )
      {}

    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;
    std::pair&lt;U,t_OBJ&gt; OBJ
      ( <span class="keyword">const</span> U*p )
      {
        <span class="keywordflow">return</span> std::make_pair( p[0]+p[1], MAX );
      }

    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;
    std::pair&lt;U,t_CTR&gt; CTR
      ( <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ic, <span class="keyword">const</span> U*p )
      {
        <span class="keywordflow">switch</span>( ic ){
          <span class="keywordflow">case</span> 0: <span class="keywordflow">return</span> std::make_pair( p[0]*p[1]-4, LE );
          <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;invalid size&quot;</span>);
        }
      }
  };
</pre></div><p> where NP and NC stand for the number of parameters and constraints, respectively; and the templated functions OBJ and CTR define the objective function and left-hand side of the constraints, respectively.</p>
<h2><a class="anchor" id="sec_MCIPOPT_solve"></a>
How to Solve an NLP Model using mc::IPOPT?</h2>
<p>We start by defining the parameter set <img class="formulaInl" alt="$P$" src="form_42.png"/> and initial guess <img class="formulaInl" alt="$p_0$" src="form_43.png"/>:</p>
<div class="fragment"><pre class="fragment">  std::pair&lt;double,double&gt; P[NP];
  P[0] = std::make_pair( 3., 6. );
  P[1] = std::make_pair( 0., 4. );
  <span class="keywordtype">double</span> p0[NP];
  p0[0] = 1.;
  p0[1] = 2.;
</pre></div><p>An <a class="el" href="classmc_1_1IPOPT.html" title="C++ derived class for NLP solution using IPOPT and FADBAD++.">mc::IPOPT</a> object is then defined:</p>
<div class="fragment"><pre class="fragment">  Ipopt::SmartPtr&lt; mc::IPOPT&lt;NLP&gt; &gt; pNLP = <span class="keyword">new</span> <a class="code" href="classmc_1_1IPOPT.html" title="C++ derived class for NLP solution using IPOPT and FADBAD++.">mc::IPOPT&lt;NLP&gt;</a>;
</pre></div><p>Note that the class <a href="http://www.coin-or.org/Doxygen/Ipopt/class_ipopt_1_1_smart_ptr.html">Ipopt::SmartPtr</a> is used here to comply with the IPOPT guidelines.</p>
<p>The NLP model is optimized as follows:</p>
<div class="fragment"><pre class="fragment">  Ipopt::ApplicationReturnStatus status = pNLP-&gt;solve( P, p0 );
</pre></div><p>where the first argument is the variable bounds and the second one, the initial guess used by the optimizer. The return value is of the enumeration type <a href="http://www.coin-or.org/Doxygen/Ipopt/namespace_ipopt.html#efa0497854479cde8b0994cdf132c982">Ipopt::ApplicationReturnStatus</a>. Moreover, the output level, maximum number of iterations, tolerance, and maximum CPU time can all be modified through the subsequent arguments of <a class="el" href="group__MCIPOPT.html#ga979727c87339765edaa2f43e9d32bbf9" title="Solve NLP model -- return value is status.">mc::IPOPT::solve</a>.</p>
<p>Finally, the optimization results can be retrieved as follows:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &lt;iostream&gt;</span>
<span class="preprocessor">  #include &lt;iomanip&gt;</span>

  <span class="keywordflow">if</span>( status == Ipopt::Solve_Succeeded ){
    std::cout &lt;&lt; <span class="stringliteral">&quot;NLP (LOCAL) SOLUTION: &quot;</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="stringliteral">&quot;  f* = &quot;</span> &lt;&lt; pNLP-&gt;get_objective() &lt;&lt; std::endl;
    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ip=0; ip&lt;NP; ip++ )
      std::cout &lt;&lt; <span class="stringliteral">&quot;  p*(&quot;</span> &lt;&lt; ip &lt;&lt; <span class="stringliteral">&quot;) = &quot;</span> &lt;&lt; pNLP-&gt;get_variable(ip) &lt;&lt; std::endl;
  }
</pre></div><p>The following result is displayed:</p>
<div class="fragment"><pre class="fragment">
NLP (LOCAL) SOLUTION: 
  f* = 6.66667
  p*(0) = 6
  p*(1) = 0.666667
</pre></div> </div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Thu Feb 13 2014 20:08:12 for GOLIB by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
