<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GOLIB: Numerical Solution and Sensitivity Analysis of IVPs in ODEs using CVODES and FADBAD++</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GOLIB
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('page_MCCVODES.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Numerical Solution and Sensitivity Analysis of IVPs in ODEs using CVODES and FADBAD++ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="author"><dt><b>Author:</b></dt><dd>Benoit C. Chachuat </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>0.1 </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>2011 </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000005">Bug:</a></b></dt><dd>No known bugs.</dd></dl>
<p><a class="el" href="classmc_1_1CVODES.html" title="C++ derived class for solution of IVPs in ODEs using CVODES and FADBAD++.">mc::CVODES</a> is a template C++ class for the numerical integration and sensitivity analysis of parametric IVPs in ODEs, </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[\dot{{\bf x}}(t)={\bf f}({\bf p},{\bf x}(t)),\ t\in(t_0,t_{N}]; \quad {\bf x}(t_0)={\bf h}({\bf p}), \]" src="form_46.png"/>
</p>
<p> where <img class="formulaInl" alt="${\bf p}\in P\subset\mathbb{R}^{n_p}$" src="form_34.png"/>, <img class="formulaInl" alt="${\bf x}\in\mathbb{R}^{n_x}$" src="form_35.png"/>, and <img class="formulaInl" alt="${\bf f}: \mathbb{R}^{n_p}\times\mathbb{R}^{n_x}\to\mathbb{R}^{n_x}$" src="form_47.png"/> and <img class="formulaInl" alt="${\bf h}:\mathbb{R}^{n_p}\to\mathbb{R}^{n_x}$" src="form_48.png"/> are twice continuously differentiable.</p>
<p><a class="el" href="classmc_1_1CVODES.html" title="C++ derived class for solution of IVPs in ODEs using CVODES and FADBAD++.">mc::CVODES</a> also supports the evaluation and sensitivity analysis of functionals depending on the IVP solutions at a finite number of points <img class="formulaInl" alt="$t_0,\ldots,t_N$" src="form_49.png"/>, with <img class="formulaInl" alt="$N\geq 1$" src="form_50.png"/>, for instance the cost and constraints in a dynamic optimization problem such as </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align*} \min_{\bf p}\ &amp; \phi_0({\bf p}, {\bf x}(t_0),\ldots,{\bf x}(t_N)) + \int_{t_0}^{t_N} \psi_0({\bf p}, {\bf x}(t))\, dt\\ \text{s.t.} \ &amp; \phi_k({\bf p}, {\bf x}(t_0),\ldots,{\bf x}(t_N)) + \int_{t_0}^{t_N} \psi_k({\bf p}, {\bf x}(t))\, dt \{\geq,=,\leq\} 0, \quad k=1,\ldots,n_c\\ &amp; \dot{{\bf x}}(t)={\bf f}({\bf p},{\bf x}(t)),\ t\in(t_0,t_{N}]; \quad {\bf x}(t_0)={\bf h}({\bf p}) \end{align*}" src="form_51.png"/>
</p>
<p> where the functions <img class="formulaInl" alt="$\phi_k$" src="form_38.png"/> and <img class="formulaInl" alt="$\psi_k$" src="form_39.png"/> are twice continuously differentiable in all their arguments.</p>
<p>The class <a class="el" href="classmc_1_1CVODES.html" title="C++ derived class for solution of IVPs in ODEs using CVODES and FADBAD++.">mc::CVODES</a> is essentially a wrapper to the solver CVODES in the software package <a href="https://computation.llnl.gov/casc/sundials/description/description.html">SUNDIALS</a>, which implement both forward and backward sensitivity analysis for IVPs in ODEs. To perform optimally CVODES requires the first and second derivatives of the RHS and IC of the ODE model as well as those of the objective and constraint functions in the dynamic optimization model. This information is generated automatically in <a class="el" href="classmc_1_1CVODES.html" title="C++ derived class for solution of IVPs in ODEs using CVODES and FADBAD++.">mc::CVODES</a> using <a href="http://www.fadbad.com/fadbad.html">FADBAD++</a>, which implements both the forward and reverse mode of automatic differentiation (AD).</p>
<p><a class="el" href="classmc_1_1CVODES.html" title="C++ derived class for solution of IVPs in ODEs using CVODES and FADBAD++.">mc::CVODES</a> is templated in the DO problem to be solved, which has to be a class derived from <a class="el" href="classmc_1_1DOSTRUCT.html" title="C++ base class for dynamic optimization problem formulation.">mc::DOSTRUCT</a>. For example, suppose we want to solve the following dynamic optimization problem: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align*} \max_{T,x_1^0,u_1,\ldots,u_N}\ &amp; T \\ \text{s.t.} \ &amp; x_1(1) = 1\\ &amp; x_2(1) = 0\\ &amp; \left.\begin{array}{l} \dot{x_1}(t) = x_2(t)\\ \dot{x_2}(t) = (u_k-x_1(t)-2*x_2(t))\theta(t)\\ \dot{\theta}(t) = T \end{array}\right\},\ t\in({\textstyle\frac{k-1}{N},\frac{k}{N}}],\ k=1,\ldots,N\\ &amp; x_1(0) = x_1^0,\ x_2(0) = 0,\ \theta(0) = 0 \end{align*}" src="form_40.png"/>
</p>
<p> with <img class="formulaInl" alt="$N=10$" src="form_44.png"/> stages. The following class is defined: </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">      #include &quot;mccvodes.h&quot;</span>

      <span class="comment">// Number of time stages</span>
      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NS = 10;
      <span class="comment">// Number of decision variables</span>
      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NP = 2+NS;
      <span class="comment">// Number of state variables</span>
      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NX = 3;
      <span class="comment">// Number of constraints</span>
      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NC = 2;

      <span class="keyword">class </span>DO : <span class="keyword">public</span> <span class="keyword">virtual</span> mc::DOSTRUCT
      {
      <span class="keyword">public</span>:
        DO()
          : mc::DOSTRUCT( NP, NX, NC )
          {}

        <span class="comment">// ODEs right-hand side</span>
   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TX, <span class="keyword">typename</span> TP&gt;
        TX RHS
          ( <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ix, <span class="keyword">const</span> TP*p, <span class="keyword">const</span> TX*x, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> is )
          {
            assert( ix &lt; nx() );
            <span class="keywordflow">switch</span>( ix ){
              <span class="keywordflow">case</span> 0: <span class="keywordflow">return</span> p[0]*x[1];
              <span class="keywordflow">case</span> 1: <span class="keywordflow">return</span> p[0]*(p[2+is]-x[0]-2*x[1])*x[2];
              <span class="keywordflow">case</span> 2: <span class="keywordflow">return</span> p[0];
              <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;invalid size&quot;</span>);
            }
          }
      
        <span class="comment">// Initial conditions</span>
        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
        T IC
          ( <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ix, <span class="keyword">const</span> T*p )
          {
            assert( ix &lt; nx() );
            <span class="keywordflow">switch</span>( ix ){
              <span class="keywordflow">case</span> 0: <span class="keywordflow">return</span> p[1];
              <span class="keywordflow">case</span> 1: <span class="keywordflow">return</span> 0.;
              <span class="keywordflow">case</span> 2: <span class="keywordflow">return</span> 0.;
              <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;invalid size&quot;</span>);
            }
          }

        <span class="comment">// Objective functional</span>
        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
        std::pair&lt;T,t_OBJ&gt; OBJ
          ( <span class="keyword">const</span> T*p, T* <span class="keyword">const</span>*x, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ns )
          {
            <span class="keywordflow">return</span> std::make_pair( p[0], MIN );
          }

        <span class="comment">// Constraint functionals</span>
        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
        std::pair&lt;T,t_CTR&gt; CTR
          ( <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ic, <span class="keyword">const</span> T*p, T* <span class="keyword">const</span>*x, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ns )
          {
            <span class="keywordflow">switch</span>( ic ){
              <span class="keywordflow">case</span> 0: <span class="keywordflow">return</span> std::make_pair( x[ns][0]-1., EQ );
              <span class="keywordflow">case</span> 1: <span class="keywordflow">return</span> std::make_pair( x[ns][1]-0., EQ );
              <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;invalid size&quot;</span>);
            }
          }
      };
</pre></div><h2><a class="anchor" id="sec_CVODES_NOM"></a>
How to Calculate a Numerical Solution to the IVP and Function Values?</h2>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Thu Feb 13 2014 20:08:12 for GOLIB by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
